<div class="modal">
  <div class="modal-header">
    <div class="button-back" (click)="goBack()">
      <i class="fa-solid fa-arrow-left"></i>
    </div>
    <div class="title">R√† so√°t c√¥ng vi·ªác</div>
  </div>

  <div class="modal-body">
    <div class="select-container">
      <div class="flex-space-between-align-item-start">
        <div>
          <app-select-multi-unit
            (selectedUnit)="listSelectedUnit = $event"
          ></app-select-multi-unit>
        </div>
        <div class="select-schedule">
          <!-- <div class="flex m-b-10">
            <div>Theo k·ª≥ th·ªùi gian</div>
            <nz-switch
              class="m-l-10"
              nzSize="small"
              [(ngModel)]="isReviewSchedule"
            ></nz-switch>
          </div> -->
          <!-- <div *ngIf="isReviewSchedule">K·ª≥ th√°ng</div> -->
          <!-- <div *ngIf="isReviewSchedule" class="repeat-schedule">
            <div class="m-r-5">T·∫ßn su·∫•t</div>
            <input
              type="number"
              class="m-r-5"
              [(ngModel)]="repeatschedule"
              [min]="1"
            />
            <div>th√°ng</div>
          </div> -->
        </div>
        <div class="btn" (click)="review()">R√† so√°t</div>
      </div>
      <div class="space-10px"></div>
      <div class="more-options">
        <div></div>
        <div class="flex">
          <div class="btn" (click)="showModalSendRemind()">üîî Nh·∫Øc nh·ªü</div>
          <div
            class="btn"
            (click)="beforeConfirm()"
            nz-popconfirm
            nzPopconfirmTitle="B·∫°n ch·∫Øc ch·∫Øn ch·ª© ?"
            [nzBeforeConfirm]="beforeConfirm"
            (nzOnConfirm)="confirm()"
            (nzOnCancel)="cancel()"
          >
            T·ªïng h·ª£p b√°o
          </div>
        </div>
      </div>
      <div class="space-10px"></div>
    </div>

    <ng-container *ngIf="isShowDataDefault">
      <nz-table
        #fixedTable
        [nzData]="listDataDefault"
        [nzShowPagination]="true"
        [nzScroll]="{ y: '600px', x: 'max-content' }"
        [nzLoading]="isloadingTable"
      >
        <thead>
          <tr>
            <th
              nzLeft
              nzWidth="40px"
              [(nzChecked)]="checked"
              [nzIndeterminate]="indeterminate"
              (nzCheckedChange)="onAllChecked($event)"
            ></th>
            <th nzLeft nzWidth="200px">ƒê∆°n v·ªã</th>
            <!-- <th nzWidth="150px">K·ª≥</th> -->
            <th nzWidth="150px">Tr·∫°ng th√°i</th>

            <th nzWidth="300px">K·∫øt qu·∫£</th>
            <th nzWidth="300px">Ki·∫øn ngh·ªã/ ƒê·ªÅ xu·∫•t</th>
            <th nzWidth="300px">Ph·∫£n h·ªìi</th>
            <th nzWidth="200px">File ƒë√≠nh k√®m</th>
          </tr>
        </thead>

        <tbody>
          <ng-container *ngFor="let group of fixedTable.data">
            <!-- D√≤ng nh√≥m frequency -->
            <tr class="group-row">
              <td
                nzLeft
                [nzChecked]="setOfCheckedId.has(group.userId)"
                (nzCheckedChange)="onItemChecked(group.userId, $event)"
              ></td>
              <td nzLeft>
                <strong>{{ group.userName }}</strong>
              </td>
            </tr>

            <!-- D√≤ng chi ti·∫øt t·ª´ng item trong nh√≥m -->
            <ng-container *ngFor="let item of group.progresses">
              <tr>
                <td nzLeft></td>
                <td nzLeft></td>
                <!-- C·ªôt K·ª≥ ƒë·ªÉ tr·ªëng cho d√≤ng chi ti·∫øt -->
                <td>K·ª≥ {{ item.periodIndex }} ({{ item.scheduledDate }})</td>
                <td>{{ item.status }}</td>

                <td>{{ item.result }}</td>
                <td>{{ item.suggest }}</td>
                <td>{{ item.feedback }}</td>
                <td>
                  <div
                    nz-popover
                    nzType="primary"
                    [nzPopoverContent]="ViewFile"
                  >
                    {{ item.file }}
                  </div>
                </td>
                <ng-template #ViewFile>
                  <div class="flex action-file">
                    <i
                      class="fa-regular fa-eye"
                      (click)="showModalFile('item.file')"
                    >
                    </i>
                    <i class="fa-solid fa-download m-l-10"></i>
                  </div>
                </ng-template>
              </tr>
            </ng-container>
          </ng-container>
        </tbody>
      </nz-table>
    </ng-container>
    <ng-container *ngIf="isShowDataByUnit">
      <nz-table
        #fixedTable
        [nzData]="listDataByUnit"
        [nzShowPagination]="true"
        [nzScroll]="{ y: '600px', x: 'max-content' }"
        [nzLoading]="isloadingTable"
      >
        <thead>
          <tr>
            <th
              nzLeft
              nzWidth="40px"
              [(nzChecked)]="checked"
              [nzIndeterminate]="indeterminate"
              (nzCheckedChange)="onAllChecked($event)"
            ></th>
            <th nzLeft nzWidth="200px">ƒê∆°n v·ªã</th>
            <th nzWidth="150px">K·ª≥</th>
            <th nzWidth="150px">Tr·∫°ng th√°i</th>

            <th nzWidth="300px">K·∫øt qu·∫£</th>
            <th nzWidth="300px">Ki·∫øn ngh·ªã/ ƒê·ªÅ xu·∫•t</th>
            <th nzWidth="300px">Ph·∫£n h·ªìi</th>
            <th nzWidth="200px">File ƒë√≠nh k√®m</th>
          </tr>
        </thead>

        <tbody>
          <ng-container *ngFor="let group of fixedTable.data">
            <!-- D√≤ng nh√≥m frequency -->
            <tr class="group-row">
              <td
                nzLeft
                [nzChecked]="setOfCheckedId.has(group.unitId)"
                (nzCheckedChange)="onItemChecked(group.unitId, $event)"
              ></td>
              <td nzLeft>
                <strong>{{ group.unitName }}</strong>
              </td>
            </tr>

            <!-- D√≤ng chi ti·∫øt t·ª´ng item trong nh√≥m -->
            <ng-container *ngFor="let item of group.progresses">
              <tr>
                <td nzLeft></td>
                <td nzLeft></td>
                <!-- C·ªôt K·ª≥ ƒë·ªÉ tr·ªëng cho d√≤ng chi ti·∫øt -->
                <td>K·ª≥ {{ item.periodIndex }}</td>
                <td>{{ item.status }}</td>

                <td>{{ item.result }}</td>
                <td>{{ item.suggest }}</td>
                <td>{{ item.feedback }}</td>
                <td>
                  <div
                    nz-popover
                    nzType="primary"
                    [nzPopoverContent]="ViewFile"
                  >
                    {{ item.file }}
                  </div>
                </td>
                <ng-template #ViewFile>
                  <div class="flex action-file">
                    <i
                      class="fa-regular fa-eye"
                      (click)="showModalFile('item.file')"
                    >
                    </i>
                    <i class="fa-solid fa-download m-l-10"></i>
                  </div>
                </ng-template>
              </tr>
            </ng-container>
          </ng-container>
        </tbody>
      </nz-table>
    </ng-container>
  </div>
</div>
<app-modal-view-file></app-modal-view-file>

<app-modal-send-remind></app-modal-send-remind>
